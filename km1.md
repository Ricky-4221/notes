- [
  首页](https://km.woa.com/?kmref=km_header)
- [发现](https://km.woa.com/discovery?kmref=km_header)
- [悦读](https://km.woa.com/read?kmref=km_header)
- [乐问](https://km.woa.com/q?kmref=km_header)
- [直播](https://tencent.lexiangla.com/lives?company_from=tencent&kmref=km_header)
- [应用](javascript:void(0))
- [我的K吧](javascript:void(0))
- [![img](https://dayu.oa.com/avatars/rickyrqzhao/profile.jpg?0) ](https://km.woa.com/user/rickyrqzhao)
- 

[![img](https://km.woa.com/files/groups/icons/16522.jpg)](https://km.woa.com/group/view)[大家谈](https://km.woa.com/group/16522) 

[加入K吧](javascript:void(0);) 

- [首页](https://km.woa.com/group/16522)
- [讨论](https://km.woa.com/group/16522/topics)
- [文章](https://km.woa.com/group/16522/articles)
- [活动](https://km.woa.com/group/16522/events)
- [投票](https://km.woa.com/group/16522/surveys)
- [相册](https://km.woa.com/group/16522/photos/albums)
- [视频](https://km.woa.com/group/16522/videos)
- [文集](https://km.woa.com/group/16522/knowledges)
- [期刊](https://km.woa.com/group/16522/journals)

一件关乎每个程序员快乐的事情正在升级

- [jiyunwang](https://km.woa.com/user/jiyunwang)
-  

- 2021年08月26日 17:41
-  

- 浏览(4539)
-  

- [收藏(107)](javascript:void(0);)
-  

- [评论(3)](javascript:void(0);)
-  

- [分享](javascript:void(0);)

**导语：**改变要从你我开始。随着Ls在战略会上宣布“研效是今年技术变革的重中之重”，“研效”已成为近期乐问乃至公司内部各类技术讨论中的热门话题。到底什么是研效？为什么要升级？研效升级仅仅是程序员的事吗？升级要怎么做？升级之后对我们每个员工有什么感知和好处？——带着这些疑问，8月18日我们在滨海大厦发起了新一期“腾讯大家谈”研效专题的讨论，刚刚成立的研效委员会会长Josephcui、研效委员会决策委员Anderszhou、腾讯文档技术负责人Batiliu，直面痛点难点，谈了他们对研效升级的认识、经验与思考。



![img](https://km.woa.com/files/photos/pictures/202108/1629970113_16_w3483_h1134.png)

👉**点击回看完整版视频：http://v8.learn.oa.com/user/net?act_id=17509**



“如果你每天在厨房工作，你会问为什么要刷锅洗碗吗？”

在谈到研效为什么要升级时，研效委员会决策委员Anders回了一个反问。对开发人员来说，研发就是每天都在做的事，而研发效率的升级则是通过更好的工具、流程和标准，让程序员的工作更高效，配合更默契，从而实现更高的开发效率，支持产品高效运营。

这不是一场运动，而是一件需要每一位腾讯工程师持之以恒、共同努力的事。

公司有多重视研效升级？研效委员会会长Joseph说，研效升级，Ls是最大的推手，Pony和Martin也在帮忙。

为什么研效要升级？在乐问上，曾有新来的技术同学以“技术沙漠”形容到了腾讯之后的感受。也有外部同行诧异：“以腾讯现在的这种研发管理能力，是怎么做到市值这么高的？”

还债、补课，做好该做的事，打造一个更稳定和高效的研发体系。研效升级这件事，对于腾讯来说，是不得不做，必须要做，关系未来，也关乎每个程序员的工作日常。

在8月18日腾讯大家谈的直播现场，来自腾讯文档的Bati就分享了自己亲身经历的“研效还债”过程，在如同凤凰涅槃的重构后腾讯文档才实现了轻装上阵，能够在最近的河南大雨中迅速响应来自一线的救援需求，支持了超大规模的并发。

缺的不仅仅是工具、流程，更深层次的是工程师文化。就在研效大家谈的同一天，乐问上[《什么是工程师文化？工程师文化在工作中如何体现？》](https://km.woa.com/q/view/264232?from=iSearch)讨论帖获得了很高的讨论热度。高赞的两个回复清晰描绘了工程师文化的特征：所有产物都以代码来体现，对代码、数据等的标准化，包括可读性、一致性、简单性等有追求，追求极致，追求开放，并身体力行地实践；将这种追求变成一种思维习惯，扩展到更多的事情上去。

标准化、一致性的基础建设和思维体系，不仅追求快，还要追求美，这是现代“工程师文化”中最核心的部分，也是“研效”这件事的关键目标。

![img](https://km.woa.com/files/photos/pictures/202108/1629970181_15_w3306_h1852.png)



## **![img](https://km.woa.com/files/photos/pictures/7b7/3d48921d0b65eedc0a1165079ca6c_w121_h92.png)**

## **从“技术债”谈起：我们欠的是什么债？**

“腾讯文档生产环境最多的时候有数千个bug。”

谈到腾讯文档曾经欠下的技术债，腾讯文档的后台开发负责人Bati心有余悸。

文档作为2018年中推出的产品，上线即爆，在行业内迅速抢到了一定声位。但初始功能简单，面对大规模用户的深度使用和优化需求，在没有任何自动化质量保障手段情况下，开发团队长期处于被业务撵着跑的状态。到2019年，线上的缺陷积压已经非常严重，甚至影响到了正常更新迭代。**Bati回忆当时的工作状态：“我们经常半夜两三点才能把需求发布出去，那时候每个月新增的bug比解决的bug还多。”**

被技术债拖得跑不动了，于是团队开始自救。

首先是底层技术的重构。腾讯文档的开发团队意识到，再也不能靠修修补补解决bug了。于是团队日夜奋战，完成了在数据、排版以及渲染层的全部重构，最初使用的开源代码全部替换为了自研代码。

同时，团队也迅速建立自动化测试和流程，来堵住新增的外网缺陷，消灭存量的技术债务。Bati带领团队阶段性投入20%-30%资源补上了存量工程的自动化测试覆盖和代码扫描缺陷，以偿还技术债务。从QCI到蓝盾到OCI各种尝试基于流水线的持续集成/持续部署，也大胆探索Monorepo和Everything As Code。把整个研效的节奏拉动了起来。时逢2019年PCG研效变革，BG层面引入了更专业更完备的DevOps的研效升级方法论，文档作为第一批试点项目，经过更多专家指导和帮助进行研效的变革升级，终于重新焕放活力。

文档涅槃重生了，但文档曾经的痛不是个例，内部很多产品感同身受。这些疼痛汇集起来，就是腾讯如今面对的尴尬现实。8月19日，乐问上另一条[《为什么公司缺乏工程师文化？](https://km.woa.com/q/view/264309?from=iSearch)[》](https://km.woa.com/q/view/264309?from=iSearch)的追问贴中，最高赞回复直接谈到了腾讯的“技术债”，即“在还没有完成软件工程基础建设的情况下，就跑步进入世界前几并持续发展，在圈地运动中获得持续的成功，忽视了基本功的建设”。

正视技术债、正视差距是变革和改善的第一步。刚刚成立的研效委员会的会长Joseph坦诚分析了腾讯的研发效能水平在业界的水准：

“**我们比微软美国落后5年左右，我们现在正在解决的问题是他们5年以前处理的问题；我们从工具体系来说比谷歌落后3、4年，但是从工程师理念来说我们落后更多。**研发效能和工程质量在谷歌和微软是作为工程师基本素养的一部分，但我们内部还处于刚刚启蒙的阶段；还有一个比较落后的是标准，不说TCP/IP这种世人皆知的，一些比较小众的标准腾讯在里面的布局也不多。

还有一个衡量指标是工具的稳定性。我们虽然孵化出了微信、QQ这样的世界级产品，但我们以前的做法是小作坊式的。一些很大的游戏，后台的团队1000人左右，再做更大、更复杂的协同就hold不住。现在我们在补课，目标是稳定性达到3个9。微软云的稳定性是5个9加一个5（百分之零点零五的冗机时间），可靠性是我们的100倍；而头条是部署在阿里云，阿里能达到4个9，也就是我们的10倍。”

但不需要因为差距而沮丧，Joseph认为：“我们虽然走在业界头部企业后面，但好在可以直面问题，吸取他们当初的经验，避开他们当初的坑。我们可以加速前进。”

互联网行业的变化趋势也在凸显研效的重要性。当前的互联网行业，主战场已经从增量市场转向存量市场，竞争方式从过往跑马圈地变成了更考验内功的存量拼杀。腾讯的业务分布非常广，过去为了快速迭代，很多业务一定程度上牺牲了研发质量，没有建立规范且具有一致性的研发管理流程，这就是冲锋时期欠下的技术债。**现在要在存量市场的拼杀中抢占和维护市场，快速响应变化，既要保证质量和创新，又要提速，研发效能的升级势在必行。**



## **![img](https://km.woa.com/files/photos/pictures/270/7764af707cb9fc5f625d113e659cc_w121_h91.png)**

## **要“效率”还是要“质量”？**

“都要。不同业务的侧重比重不一样，对于微信支付来说，质量是最重要的。”

研效委员会决策委员、微信支付研发部助理总经理Anders说。在这次的腾讯大家谈直播中，Anders第一次全面分享了微信支付研效升级的过程。

在研效升级的路上，微信支付走得比较靠前。基于业务特性，完成了全流程安全、稳定性、正确性规则的搭建和架构适配，并通过结构化规范提高了人员效率。Anders归总为六条：

第一，**让业务团队全面了解研发场景**，特别是对支付研发中要面对大量非功能性需求这一点达成共识，在共识基础上部署研发人力。微信支付是典型的“冰山型应用”，即产品针对目标系统提的需求是功能性的，还有大量的非功能需求需要研发团队完成。“这一点研发团队一定要让业务全面了解，和业务团队对齐目标。”Anders表示。

第二，**干掉专门的测试环节，转为开发自测。**当时的局面是开发与测试的人员比例是1：10，测试跟不上开发的节奏，测不出真实问题，而开发在测试兜底的情况下又产生依赖。Anders在当时的情况下破釜沉舟，把测试全部转为开发，让他们去做工具。让每位开发人员对自己的作品负责，“质量不是测试出来的，而是设计出来的”。

第三，**找到研发痛点，有针对性地改进。**比如为了提升编译的速度，他们把业务拆成了小仓，同时解决引用关系的问题，在小仓之间形成打通。从2019年开始，微信支付就用问卷调查不断收集研发痛点，获取各种反馈，并从中不断发现需要改进升级的问题。

第四，**建立安全红线意识。**统一认知，做好工具，严格考核。安全考试每半年或季度进行，分技术人员和非技术人员两套卷子，要求全员必须100分。

第五，**借开源协同的东风，用好公共组件**，参加混沌工程和一些Oteam，确保可以在很少人的情况下做更多异常的测试。在公司内部有一些针对蓝盾的吐槽，微信支付也是蓝盾的使用方，而且用得很好。Anders对此打了一个比方，工具就像高速公路，业务是车，路修好了，车怎么上去是业务研发自己要解决的事。

第六，**针对开发人员效率问题，做需求管理系统**，设立专门的业务架构组把产品需求并行转译成规范需求，内部提倡用文档来沉淀，不在白板上画，规避人员流动带来的知识断层。

通过以上六条，Anders带领微信支付团队以几百人的研发队伍支持了一个几亿用户的应用的开发与运维。在“与业务团队达成共识”“发现和解决痛点”“合理安排优先级”“善用工具”等方面，微信支付的理念和实践，都值得其他业务团队研究借鉴。

Anders特别强调信息的透明和过程反馈，“把事儿拉出来”，定位问题之后解决问题。他也要求把涉及内部支撑的非功能性需求计入开发的需求单，这样和业务对齐目标，一起改善痛点。

在微信支付，负责的VP Xiaokang把安全和质量视为生命线，因为以支付的规模，一秒的失误所带来的影响与损失也不可估量。所以**在微信支付的研效升级中，质量的稳定性和安全是第一目标。但业务不同，偏重也会不同**，特别是对一些还在爬坡期的业务，产品需要快速更新迭代，就会对开发效率有更高期待。在场的两位研效委员强调，研效的提升最终要为业务服务，一定要深入了解业务的需求，与业务一把手达成一致，根据不同场景因地制宜地制订目标和布署人员。

业务场景的多元是腾讯在研效升级中最特殊的一点，这是挑战也是机会**。“在中国互联网里，你把腾讯搞定就基本上搞定了中国一半的互联网应用场景。从支付场景-社交场景-文档共享-内容生态-游戏，现在还有2B，面对这样丰富的业务我们对市场的响应必须很快。”Joseph认为，这样的经验未来会有广阔的应用。**



## **![img](https://km.woa.com/files/photos/pictures/32e/c0527952a3fc10230c9ce14e873bf_w116_h91.png)**

## **为什么说“一致性”是当前研效升级亟待解决的问题？**

7月22日，《持续交付 2.0 》的作者乔梁老师在[腾讯CI day](https://km.woa.com/group/37529/articles/show/480964?jumpfrom=systemmail)的会场分享了对“一致性”的理解：

“一致性会为组织带来逆熵，使其在规模化的过程中更加有序，从而带来效能提升（至少可以保持不降）。**为系统化组织注入一致性，要从三个方面入手：流程机制、工具平台、人员能力。”**

简单说，只有保持“一致性”，才能让大团队内部的沟通和协作成为可能。

许多与微信各条业务线打过交道的团队，合作中都会感叹WXG内部的效率和一致性。作为直播当天在场唯一的WXG嘉宾，对于“一致性”，Anders表达了他的理解：

**“一致性在研发团队的最高境界体现就是像军队一样，令行禁止，整齐划一。”**

Anders结合微信支付业务实际，将“一致性”这个“弱”名词，拆分成了几层有实际意义的“强”名词，并分别介绍了微信支付在对应层面的实践。

架构层面的一致性，Anders分享了一件“陈年往事”：2014年WXG成立，Anders的团队刚加入WXG，他决定舍掉原平台的组件，全力拥抱WXG的基础架构。切换过程中有短期的不习惯，但术业有专攻，有专门的人维护基础组件，团队的人力得到有效节约。同时建立了“可靠的实验中心”，业务系统之间完全通过微服务的架构做聚合，这就把一个很难的技术问题门槛一下子降低了，对效能产生了直接改善。

**沟通语言的一致性**，降低交接、沟通的理解成本。就像普通话的普及一样，把业务术语也统一起来，建立名词系统，形成规范，所有行文要一致。

**数据的一致性**，是把账号的构成规律、字节长度形成规范，下游系统引用同一规则的上游数据。

**规则的一致性**，是配套建立一致性的规则工具，按照同样的标准维护，并使用工具帮助开发做门禁。同时参照公司的代码规范，逐渐从小团队的代码的检查工具切换到公司的检查工具。

**管理的一致性**，即项目执行之后需要有复盘，复盘是“一把手工程”，核心靠质量去牵引。

**目标优先级的一致性**，要将技术债务透明，公开给产品团队和业务团队，达成阶段性保障重点的共识，透明带来信任。

**实现平台和工具的互联互通是研效委员会成立之后的第一要务，这也是为了“一致性”的目标**。Joseph说，这是一个点一个点打通的过程，为了互联互通，研效委员会会先在公共组件上发力：

“所谓的研效平台打通是至少从名词上要打通，数据标准上要打通，接下来可能是调用接口要打通。这是很现实的问题，我们要打通很多现有工具的时候，首先取他们的最大公约数、大家都有的交集提取出来作为打通的基础。这是渐进的过程，一个点一个点去打通。”

同时，**在管理的一致性层面，Joseph补充了两个“全”理论：**

**第一是全链路**，从需求到上线到故障复盘，全链路是不断循环的。

**第二是全生命周期**，上线以后的产品就像一个生命一样，有生老病死，有孵化期-爬坡期-成熟期-下线期，是一个循环。

“我们管理的同学需要有这样的视野，不单单只是功能的上线，还要包括功能的下线。我们系统里有很多微服务，一直在那儿，它真正挂了多少流量很少人知道。所以运维的同学很痛苦，他不知道这个微服务能不能下。没人能告诉他，连这些微服务的代码在哪里我们都不知道。这就说明有一些模块的全生命周期管理失控了，这些模块服务不断挤压我们的资源。这些资源完全可以释放出来。当我们有了两个“全”以后，一致性目标就更容易形成了。产品技术最终是为了业务，业务好，大家才能更好。”

持续战斗在腾讯文档研发一线的Bati认为业务侧对“一致性”的诉求很高，“目前遇到最大的问题就是代码一致性和工具一致性的问题。”代码一致性的好处是做一件事就在一个地方只有一份代码，修改是原子的，影响是实时同步的，自动化的保障手段可以立即进行；工具的一致性避免了流程的混乱、数据传递的丢失，使得持续改进成为可能。同时，在自动化和大规模的生产的核心诉求下，没有一致性寸步难行。



## **![img](https://km.woa.com/files/photos/pictures/2cf/515f9a882ee142f7230af13ee3d89_w121_h91.png)**

## **研效委员会当前的三个主要命题**

在[研效委员会的技术图谱](https://techmap.woa.com/domain/5)中，我们可以看到研效委员会愿景的第一条内容就是：让每一位腾讯的工程师能够高效、快乐地工作。

**研效升级的初心，就是通过工具、流程、文化的梳理，真正提升研发的幸福感，把工程师解放出来，去做他们最精通的事，写高质量的代码。然后有一套很好的系统去做各种各样的保障**，有快速的反馈链路可以反馈是不是出现了问题，也可以进行快速修复。

为了达成这样的愿景，Joseph把研效中的所有问题按照重要性和紧急度拆分成四个象限，排在重要且紧急象限里的任务是工具互联互通、资源保障，在重要不紧急的象限里是文化建设，这三个问题是目前最主要的工作。他强调，在当下尤其重要的是“公共组件的开发”：

“工具把最核心的东西做好就行了。互联互通和标准化的问题是个很大的痛点。如果不解决这个问题，类似的业务诉求要做N遍。比如在公司里我们知道大的CI系统就有4个，还不包括自己攒的那些。怎么把这些已有投资利用起来，这是工具的互联互通。”

如果说工具的互联互通是在现有工具上通过标准和规则的统一建立关联，那么资源保障就是在没有很成熟的工具的时候，先花点钱在短期内把痛点解决。正如Facebook很著名的那句话，“宁可机器等人，不要人去等机器”。

“保证资源充足的情况下还要提升稳定性。构建机器、测试机器不要跑到一半要重启甚至手工重启。这也是我们资源保障需要做的。”

第三个命题是文化建设，这个被归类在“重要不紧急”象限。通过耐心的布道和养成，提升工程师的素养，建立工程师文化。

这三个命题各有侧重，却又相互关联。Joseph介绍三者的关系：

“**目前我们选了三个最主要的课题。一个内部工具打通，标准化执行； 再一个就是资源保证，保证有，也要保证稳。第三个是从意识上着手，从启蒙到进阶，到全体形成真正的工程师文化。这是目前最主要的三个工作。”**



## **![img](https://km.woa.com/files/photos/pictures/dd8/8fbee5c6511560139c73bd886784a_w121_h92.png)**

## **工程师文化的核心：自己动手，精益求精**

在新代码文化故事不打烊系列文集中有一篇[《名字服务——点亮夜空中最亮的星》](https://km.woa.com/group/17516/articles/show/460028?kmref=knowledge)，里面介绍了一个小故事：SaaS软件开发Jason发现，业务在使用tnginx做反向代理时，通常会遇到upstream硬编码ip的问题，使得业务在扩容或者机器裁撤时，需要修改很多机器的nginx配置并且重启服务，不仅不便，还容易出错。而北极星优化了l5的很多问题。于是他自己上手，花了几个周末默不作声地把tnginx和北极星实现了打通，并把代码贡献给了Oteam。

对于研效升级究竟应该谁来做，Anders打了一个比方：**“日常研发和研效升级的关系就像做饭和洗锅一样，是顺手就应该做了的事。鞋合不合脚只有自己知道，研效的升级，也应当由研发自己有意识地做。”**

Joseph则进一步畅想，这个文化的最佳状态是：“当我们发现在某个地方效能受阻，大家都自己去解决问题，然后把这个解决方案反哺到系统里让别人也能受益。”至于“一致性”，Joseph认为：“研效最大的一致性就是大家认为研效责无旁贷，每个人都有份。”

在他看来，研效不需要上来就放卫星，可能是很小的一点。比如腾讯很多业务像腾讯视频、腾讯会议、微信、游戏都要用到视频的编解码技术。如果能把编解码的效率调高1%，对腾讯来说可能就节省好几亿的资源。很多时候研效的东西就是很多个百分之一、百分之零点几叠加起来的。不嫌小，但要尽早开始做、身体力行做。”

工程师文化的核心是“身体力行，精益求精”。孟子“穷则独善其身，达则兼济天下”的追求在工程师文化中同样适用。**“我们可以通过发起或加入Oteam的形式推进更广大范围“一致性”的达成，也可以在自己的方寸之间规范自己的代码质量，做力所能及地I打通和协同，身体力行为研效升级做出自己的贡献。”**Joseph说。



## **![img](https://km.woa.com/files/photos/pictures/012/3307e968df90be914bbf7540b7af7_w115_h93.png)**

## **这是一件关乎每个腾讯工程师快乐的事情**

常听见有人抱怨，需求似乎永远都做不完，深陷在没有尽头的加班里面，找不到人生方向和成就感，谈何快乐？是不是效率和快乐本身就是矛盾的？

Joseph认为，在研效升级这条路上，高效和快乐可以兼顾：

“高效只是做事，快乐是发自内心地想改变一些东西。如果只提高效，不考虑人的问题的话，做到后面就是把人当机器在用，这个导向是不对的。腾讯还是关心人的文化，我们要让每个程序员高效又快乐。两者要兼顾。对工程师来说最大的快乐就是一个东西做得有成就感，其次是他觉得做的东西不拖泥带水，不是像打怪一样一路打下来，而是顺顺利利就把想做的东西做了。”

Anders补充，研效提升后，由于系统的支持，故障变少了。当故障不是老板或者用户发现找上门来，而是自己发现的，每个工程师可以更从容地解决问题时，他会感受到一种平和的快乐。

Bati总结了交付过程中的幸福感标准：

“**幸福感有两个具体指标，一是我们价值交付的速度**，产品提一个需求，你多快可以交付到用户手里，产生用户价值；**第二个就是价值交付的频率**，如果交付频率很快，也印证了有能力可以快速支撑快速交付。就像上次河南水灾的事情，我们半夜修改特性、上线，支撑一个大规模并发性的体验。这些交付过程都不到半小时，而且自动化做了质量保障。**这两个做好了，明显可以提升快速交付的质量。相信很多程序员的幸福感的根源就来自快速交付用户价值**。”

研效提升的话题还有很多，讨论随时随地在进行。这是一条关乎腾讯工程师快乐的路，是公司长期要不断爬坡提升的项目，与每个人息息相关。追求永无止境，研效升级才刚刚开始。

![img](https://km.woa.com/files/photos/pictures/202108/1629970636_51_w988_h740.png)





## **附：部分现场精彩互动Q&A**

## *测试没有银弹，不要迷信任何一种*

### Q：希望代码尽量左移，研效委员会有规划做统一的测试平台吗？

**Joseph：**首先**这是在我们的规划里的**。至于什么时候能够达到大家希望的水平，可能各个BG不一样，各个业务也不一样。PCG的试点业务比如视频、微视、文档已经开始攻坚，做出了一点成绩。也就是说测试左移的同时整个测试或者整个链路的效率是作为一级指标在观察的。这个的确是在我们的大盘里面，而且是放在了工具互通的后一“part”。

**Bati：**质量左移是整个研效里非常核心的环节。这个过程好在前期不太强依赖工具，没有一个统一的工具大家也都能做——自动化测试有成熟的理论和框架。在持续集成做得好的时候，大量问题在前置阶段就能发现。等持续交付做好以后，到了部署阶段，做自动化部署挑战会大一点，因为他就强依赖于工具和平台能力了。发布阶段如果有了工具有了自动化监控和回滚，那就更幸福了。这一块可能期待和公线、和Joseph他们把工具平台建设好，我们一起去试用。

**Anders：蓝盾大家都很熟悉，它是个流水线。流水线跑什么车，得开发自己想办法。不能路修好了，你的车还是个架子车、拖拉机，上不去就没有用。你需要的可能是个重型卡车，这事得自己解决**。所以生产车跟造路，两个不是因果关系或者先后，可以同时做。甚至业务可能还要走得更前面一点。开发这里可以做的事情很多，比如你的单测，如果你还要对外提供API，那你基于API的这个集成测试、这个接口、契约级的测试要不要做？这都是你的左移，但这个一定不能让你的调用团队去做。

效率改善其实还有很多事我们完全可以自己做。一旦面向契约编程，你的设计就要考虑到前面。这里的成本选择是你要跟你的管理者达成共识的，不同业务选择的测试点是不一样的。

测试体系是个金字塔，成本最低应该是单元测试，集成测试在腰部。业务可以根据自己的特点选择。这个需要我们开发人员认真去选一下软件测试的方法。**我有个建议，研效委员会可以组织大家全员学习测试理论，这个可以帮大家实打实解决问题。**有的业务就适合从API测试直接往下对，不要测单测，因为他最终看的就是给用户的交付。还有，单测都对，集成到一起不一定都对。层越多，可能的问题就越多。所以测试没有银弹，没有任何一个测试方法可以告诉你说做了单测后面都是对的，不可能。每一层，每一种方式可能都要去做一些事情，只有这样才能尽可能覆盖系统设计和期望交付之间的鸿沟。不要迷信任何一种，因为质量的要求决定我们不可以有失误。

还有你做的系统对质量的要求也决定了你在测试方面的投入。比如说海量之道里面我们讲灰度发布本身就有一种能力来提供重测的，是靠用户帮助我们发现问题，当你测试不足时它是一个很好的补充。这在2C的产品中是允许的，但是在微信支付这里不行，灰度发布不是测试工具。

**Joseph：**我再给一些团队做做广告。如果你有兴趣的话，**测试委员会里有很多Oteam，可以请他们看看哪一款工具更适合你的业务。**他们做了很多推荐，比如说现在有流量转用例的那种测试、还有UI自动化的测试，还有甚至有一些可能通过字节码的逆编译把你在安卓上用JAVA语言写的程序产生出单测的框架。这些能够降低你写测试的成本。所以有兴趣的话可以去测试委员会的Oteam去看一下，看看哪一款工具更适合你的业务。

业务不同对质量的要求不同，**现在自动驾驶挺火的，但是你愿意用生命去给它做灰度吗？**一些关键的软件工具是不可能灰度的，但有一些可以灰度。



## *大仓小仓都有它的意义，比它更重要的是公共组件库的建立*

### Q：对于大仓的规划、未来目标怎样的？

**Joseph：大仓和小仓都有它的意义。小仓灵活，大仓更容易做一致性**。大仓本身带来的优劣我推荐你读文章[《大仓沉思录》](https://km.tencent.com/openkm/url/xvwxjo)，写得很具体。大仓不单单只是一个代码的聚合，后面是一套工具体系和研发理念的升级和改变。

但是更重要的一点是，聚合之后对整个构建系统是产生了一个比较大的压力的。大仓真正的优势要通过声明式、增量式的编译才能真正体现。我们目前离这个目标还有点远。

第三点是大仓和小仓最终都要解决代码一致性的问题。大仓玩得比较好的比如谷歌，是全公司一个大仓。小仓玩得比较好的是亚马逊，但是他的小仓不是随意建立的，而是在建立的时候有个模板式标准帮你。它又有很强的制品库的管理。所以它使用另外的手段进行一些保障，既体现了小仓的灵活性，又在一定程度上尽量保证代码或者整个系统的一致性。

**至于腾讯会不会将来走到全公司一个大仓，我个人认为不一定有必要**。一种可能的结果就是每个业务线，或者每个大的产品线聚合成一个大仓，腾讯有一些公共组件库——这是大仓。比如下面的路由、可靠的消息件等这些不用再去整了，业务特定的需求还是根据自己的需求在另外一个仓里，仓与仓之间的引用是通过制品库的管理，是强声明式的，有很好的一致性。这样的话既有了大仓的一致性，也有一定的灵活性。这是可能的一种结局。

*从目前的情况，腾讯内部的小仓的路有点走歪了*，我们现在的小仓太多。这是不可持续的，也是不可维护的。如果你把代码作为资产的话，我们有很多资产是没有人维护的。

**Anders：**其实仓这个事情本身是个管理问题，从开发的角度讲，最关注的是本地就能做。本地就能编译，不要搞得很麻烦。所以我们的实践有点像亚马逊，是有规划的小仓。

**大仓和小仓最终是实现一致性的手段，所以各个业务要根据自己情况去看。**比如我们还很特殊，我们的仓是不开源的，只有很少的权限，因涉及安全和合规等等。很多因素是在做这个事情的时候，要从管理上去思考的。

当然治理很重要，顶层设计治理一定要跟上。大仓和小仓最后仍然是为了一致性服务的，核心是为了治理。大仓不是目标，是可能的手段之一。

**Joseph：现在比较核心的一个点是，腾讯是不是要规划一个公共组件仓库。把所有的业务都纳到一个仓是不现实的，微软也好，谷歌也好，有一些相对比较保密的东西是不允许放到一个大仓里面去的。**谷歌说一个大仓，其实旁边挂了一些小仓，是有保密性质的。

从我们的整体规划来说，我们需要建立一些公共组件，打磨到极致，然后让大家可以快速复用，这可能比所谓的大仓小仓更重要。当然这个公共组件最终的一个形态可能是一个比较大的中型仓库。这样唯一版本的一致性可以得到更好的保证。

**Bati：**我也谈谈业务侧用大仓的一个感受。我们试用过效能部大仓的一些解决方案，曾经需要几分钟克隆的一个上百万行的仓库，到最后只需要不到10秒钟。这个体验非常好。

有了大仓还可以做远程编译，有分布式编译的集群，编译起来比单机更快。

大仓代码管理有一个tips大家一起注意：当我们把几十亿行代码放到一个仓库里面，或者可能业务小一点，几千万，这些代码之间的依赖管理一定要做好。如果不做好依赖管理，这些代码放到一个仓库里面又有什么意义呢，还是一个个的孤岛。如果在大仓里面做好依赖管理，包括小仓自己也通过源数据、制品做好依赖管理，那么就容易被治理。这个是非常重要的一个手段，如果代码优化，那么被依赖的代码也要能感知到，进行自动化测试，接下来可以做精准测试、精准部署，这些行为都能做。



*策划：youngma / lydia / camerawang*

*撰文：jiyunwang*

*编校：camerawang*

最后更新于 2021-08-27 10:51

如果觉得我的文章对您有用，请随意赞赏

赏

[3人已赞赏](javascript:void();)

[![img](https://dayu.oa.com/avatars/camerawang/profile.jpg) ](https://km.woa.com/user/camerawang)[![img](https://dayu.oa.com/avatars/neoxuzhang/profile.jpg) ](https://km.woa.com/user/neoxuzhang)[![img](https://dayu.oa.com/avatars/rosaluo/profile.jpg)](https://km.woa.com/user/rosaluo)



仅供内部学习与交流，未经公司授权切勿外传

标签：[一致性](https://km.woa.com/group/view/articles?tag_id=1274)(2) [工程师文...](https://km.woa.com/group/view/articles?tag_id=36262)(4) [开源协同](https://km.woa.com/group/view/articles?tag_id=162889)(2) [研发效能](https://km.woa.com/group/view/articles?tag_id=171912)(14) [研效](https://km.woa.com/group/view/articles?tag_id=184342)(3)

![img](https://km.woa.com/operations/get_wechat_image?target_url=https://km.woa.com/group/16522/articles/show/483455)

本文专属二维码，扫一扫还能分享朋友圈

想要微信公众号推广本文章？[点击获取链接](javascript:void(0);)

#### 相关阅读

-  [乔梁：一致性，是研发效能提升的必经之路](https://km.woa.com/posts/show/516327?kmref=related_post)
-  [浅谈工程师文化 - 基础篇](https://km.woa.com/posts/show/518755?kmref=related_post)

我顶 (32)

收藏 (107)

- [转载 (5)](javascript:void(0);)

   

- [收录](javascript:void(0);) 

- [评论 ](javascript:void(0);)(3) 

- [反馈](javascript:void(0);)

分享到 

大家评论

[![img](https://dayu.oa.com/avatars/jessiezwang/profile.jpg)](https://km.woa.com/user/jessiezwang)

[jessiezwang](https://km.woa.com/user/jessiezwang)

2021-08-27 11:09:46

![img](https://km.woa.com/img/face/76.gif)

 顶 [ 回复](javascript:void(0);)

[![img](https://dayu.oa.com/avatars/javaliu/profile.jpg)](https://km.woa.com/user/javaliu)

[javaliu](https://km.woa.com/user/javaliu)

2021-08-28 00:34:36

深度好文

 顶 [ 回复](javascript:void(0);)

[![img](https://dayu.oa.com/avatars/iculi/profile.jpg)](https://km.woa.com/user/iculi)

[iculi](https://km.woa.com/user/iculi) 

2021-08-29 11:38:01

只看标题还以为要取消996了呢

 顶 (8) [ 回复](javascript:void(0);)

[![img](https://dayu.oa.com/avatars/rickyrqzhao/avatar.jpg)](https://km.woa.com/user/rickyrqzhao)

[ ](javascript:void(0);)[切换到更多功能](javascript:void(0);)

关于作者

- [![img](https://dayu.oa.com/avatars/jiyunwang/profile.jpg?1498094744)](https://km.woa.com/user/jiyunwang)

  [jiyunwang(王季赟)](https://km.woa.com/user/jiyunwang) S3\企业文化部\策略研究组员工

作者文章

-  [一件关乎每个程序员快乐的事情正在升级](https://km.woa.com/posts/show/518947?kmref=author_post)
-  [活水到了新团队，如何找到自身坐标和定位，实现价值？](https://km.woa.com/posts/show/516381?kmref=author_post)
-  [高兴会长离开北京啦，在影协几年过得很开心，谢谢你们](https://km.woa.com/posts/show/516238?kmref=author_post)
-  [晋级答辩准备环节经验分享](https://km.woa.com/posts/show/493847?kmref=author_post)
-  [品牌该怎么把浪费的那一半广告费花明白？](https://km.woa.com/posts/show/478013?kmref=author_post)

收录于

- [![img](https://km.woa.com/img/event.png)](https://km.woa.com/knowledge/6290)

  [广州腾讯研发](https://km.woa.com/knowledge/6290)浏览 18 收藏 0



Copyright©1998-2021 Tencent Inc. All Rights Reserved

腾讯公司研发管理部 版权所有

[广告申请](https://km.woa.com/chartlets/km/) [反馈问题](javascript:void(0);)

[731/743/503 ms]